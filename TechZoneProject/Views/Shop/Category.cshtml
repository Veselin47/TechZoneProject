@using TechZone.Web.ViewModels.Shop
@model AllProductsViewModel

@{
    ViewData["Title"] = ViewData["CategoryName"];
    var categoryId = ViewData["CategoryId"]?.ToString()?.ToLower();
}

<div class="shop-container">

    <div class="section-title">
        <h2>@ViewData["CategoryName"]</h2>
        <span class="count-badge">(@Model.Products.Count() намерени)</span>
    </div>

    <form method="get" asp-controller="Shop" asp-action="Category" asp-route-id="@categoryId">

        <div class="shop-layout">

            <aside class="filters-sidebar">
                <h3><i class="fas fa-filter"></i> Филтри</h3>
                <div class="divider"></div>

                <div class="form-group">
                    <label class="form-label">Търси модел</label>
                    <input name="SearchTerm" value="@Model.SearchQuery.SearchTerm" class="tech-input" placeholder="..." />
                </div>

                <div class="form-group">
                    <label class="form-label">Цена (лв.)</label>
                    <div class="price-range">
                        <input name="MinPrice" value="@Model.SearchQuery.MinPrice" type="number" class="tech-input" placeholder="От" />

                        <input name="MaxPrice" value="@Model.SearchQuery.MaxPrice" type="number" class="tech-input" placeholder="До" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Производител</label>
                    <select name="Brand" class="tech-input tech-select">
                        <option value="">-- Всички --</option>
                        @foreach (var brand in Model.Brands)
                        {
                           
                            if (Model.SearchQuery.Brand == brand)
                            {
                                <option value="@brand" selected>@brand</option>
                            }
                            else
                            {
                                <option value="@brand">@brand</option>
                            }
                        }
                    </select>
                </div>

                @if (categoryId == "ram" || categoryId == "gpu")
                {
                    <div class="divider"></div>
                    <div class="form-group">
                        <label class="form-label">
                            @(categoryId == "ram" ? "Памет (GB)" : "Видео памет (GB)")
                        </label>
                        <input name="MemorySize" value="@Model.SearchQuery.MemorySize" type="number" class="tech-input" />
                    </div>
                }
                @if (categoryId == "storage")
                {
                    <div class="divider"></div>
                    <div class="form-group">
                        <label class="form-label">Тип Диск</label>
                        <select name="StorageType" class="tech-input tech-select">
                            <option value="">-- Всички --</option>

                            @if (Model.SearchQuery.StorageType == "SSD")
                            {
                                <option value="SSD" selected>SSD (Solid State)</option>
                            }
                            else
                            {
                                <option value="SSD">SSD (Solid State)</option>
                            }

                            @if (Model.SearchQuery.StorageType == "HDD")
                            {
                                <option value="HDD" selected>HDD (Hard Disk)</option>
                            }
                            else
                            {
                                <option value="HDD">HDD (Hard Disk)</option>
                            }
                        </select>
                    </div>

                    <div class="form-group mt-2">
                        <label class="form-label">Капацитет (GB)</label>
                        <input name="MemorySize" value="@Model.SearchQuery.MemorySize" type="number" class="tech-input" />
                    </div>
                }
                <div class="divider"></div>

                <button type="submit" class="btn-tech">
                    Приложи
                </button>

                <a asp-controller="Shop" asp-action="Category" asp-route-id="@categoryId" class="btn-outline">
                    Изчисти филтрите
                </a>
            </aside>

            <main class="products-section">

                <div class="sorting-bar">
                    <label>Сортирай по:</label>
                    <select name="Sorting" class="tech-select" onchange="this.form.submit()">
                        <!option value="0" @(Model.SearchQuery.Sorting == 0 ? "selected" : "")>Цена (Възходяща)</!option>
                        <!option value="1" @(Model.SearchQuery.Sorting == 1 ? "selected" : "")>Цена (Низходяща)</!option>
                        <!option value="2" @(Model.SearchQuery.Sorting == 2 ? "selected" : "")>Най-нови</!option>
                    </select>
                </div>

                <div class="tech-grid">
                    @if (!Model.Products.Any())
                    {
                        <div class="no-products-message">
                            <h3>Няма намерени продукти.</h3>
                        </div>
                    }
                    else
                    {
                        @foreach (var product in Model.Products)
                        {
                            <div class="card">
                                <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name">
                                <div class="card-body">
                                    <h5 class="card-title">@product.Name</h5>
                                    <p class="card-brand">@product.Brand</p>

                                    <div class="price-tag">@product.Price.ToString("C")</div>

                                    <div class="stock-status">
                                        @if (product.IsAvailable)
                                        {
                                            <span class="badge badge-success">Наличен</span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-danger">Изчерпан</span>
                                        }
                                    </div>
                                </div>
                                <div class="card-footer d-flex justify-content-between">
                                    <a asp-controller="Shop" asp-action="Details" asp-route-id="@product.Id" class="btn btn-sm btn-outline-light">
                                        <i class="fas fa-info-circle"></i> Детайли
                                    </a>

                                    <div class="btn-group">
                                        <a asp-controller="Wishlist" asp-action="Add"
                                           asp-route-productId="@product.Id"
                                           asp-route-returnUrl="@Context.Request.Path@Context.Request.QueryString"
                                           class="btn btn-sm btn-outline-danger" title="Добави в любими">
                                            <i class="far fa-heart"></i>
                                        </a>

                                        @if (product.IsAvailable)
                                        {
                                            <a asp-controller="Cart" asp-action="Add"
                                               asp-route-productId="@product.Id"
                                               asp-route-returnUrl="@Context.Request.Path@Context.Request.QueryString"
                                               class="btn btn-sm btn-success" title="Купи">
                                                <i class="fas fa-shopping-cart"></i>
                                            </a>
                                        }
                                        else
                                        {
                                            <button class="btn btn-sm btn-secondary" disabled>
                                                <i class="fas fa-times"></i>
                                            </button>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    }
                </div>
            </main>
        </div>
    </form>
</div>